+----------------------------------+
|   Installation Guide for Linux   |
+----------------------------------+

NOTE:   Follow this guide very carefully. It's important to follow every step to
        make sure that everything can be build and run successfully.
		

    Directories
====================================

ElectricVehiclePricing      :       The root directory.
    Build                   :       Contains the XML-files that are needed to
                                     build the OSGi bundles.
    Config                  :       Contains the configuration files. You can
                                     specify some settings here.
    Data                    :       Contains the data that will be used in and generated
                                     by the software.
    Feathers2               :       Contains the Feathers2 core and services.
    Libraries               :       Contains all the used libraries (internal
                                     and external libraries).
    Log                     :       Contains everything that is logged while
                                     building the bundles, starting up the bundles
                                     and running the software.
    Output                  :       Contains the files, generated by the ant
                                     compiler (while building the bundles).
									
						
    Downloads (Software)
====================================

There is some software you need. Our software is developed with Java, so you 
need the Java SDK to compile our software. To run our software, we use the OSGi framework. 
This framework is build with the ant compiler, so you need ant. Our scripts are made in
python and these scripts make use of netcat. The software generates .plt files which can
be transformed to .png files with GNUplot. With the following commands you are good to go:

    > sudo apt-get install openjdk-7-jdk
    > sudo apt-get install ant
    > sudo apt-get install python
    > sudo apt-get install netcat
    > sudo apt-get install gnuplot-x11
			
								
    Downloads (Libraries)
====================================

We use a lot external libraries and frameworks. We are not allowed to distribute
these libraries, that's why you have to download these libraries and frameworks
by yourself.

Download:

    (1) OSGi                :       The OSGi framework jar
                                     http://www.eclipse.org/downloads/download.php?file=/equinox/drops/R-KeplerSR2-201402211700/org.eclipse.osgi_3.9.1.v20140110-1610.jar
    (2) CSV Reader          :       The Java CSV Library
                                     http://sourceforge.net/projects/javacsv/
    (3) Log4J               :       The Apache Log4J
                                     https://logging.apache.org/log4j/1.2/download.html
    (4) ant-contrib         :       The ANT contrib bin
                                     http://sourceforge.net/projects/ant-contrib/files/ant-contrib/1.0b3/
    (5) gnu-getopt          :       The GNU getopt jar
                                     http://www.urbanophile.com/arenn/hacking/download.html


    Copying the downloads
====================================

In our build and compile scripts, we use static paths. For that reason, it's important
that all the downloaded files are named correctly and placed in the correct directory.

We refer to the numbers from the "Downloads (Libraries)" section:

    (1)	Rename to           :       org.eclipse.osgi.jar
        Copy to             :       ElectricVehiclePricing/Libraries/external/equinox/
    (2)	Rename to           :       csvreader.jar
        Copy to             :       ElectricVehiclePricing/Libraries/external/csv/
    (3)	Rename to           :       log4j.jar
        Copy to             :       ElectricVehiclePricing/Libraries/external/apache/
    (4)	Rename to           :       ant-contrib.jar
        Copy to             :       ElectricVehiclePricing/Libraries/external/ant/
    (5)	Rename to           :       gnu-getopt.jar
        Copy to             :       ElectricVehiclePricing/Libraries/external/gnu/

NOTE:   Extract the downloaded file if necessary and find the jar with which we
        will continue in the next step.


    Running some scripts
====================================

Because we user the OSGi framework, every jar file needs to have a manifest file with
specific fields. Not every jar that you have downloaded in the previous steps
has a manifest file with these fields. That's why you have to run the following script in the 
ElectricVehiclePricing directory:

    > python install.py linux

NOTE:   This script can complain about already existing fields in the manifest file. This forms
        no problem there the script will overwrite these fields to their correct value.


    Building the bundles
====================================

Everything is ready to build. Run the following command in the ElectricVehiclePricing directory
to build the OSGi bundles:

    > python antBuild.py
	
If everything went well, the bundles are build and ready to use.


    Input/Output Files
====================================

The software uses the following input files:

    ElectricVehiclePricing/Data/widrs/input/schedules/prdToAscii.csv
    ElectricVehiclePricing/Data/widrs/input/schedules/episodeFileAfterRescheduling.csv
    ElectricVehiclePricing/Data/widrs/input/schedules/episodeFileBeforeRescheduling.csv
    ElectricVehiclePricing/Data/evcwidrs/input/priceEnergyDir/greenEng01122013.csv
    ElectricVehiclePricing/Data/evcwidrs/input/priceEnergyDir/price01122013.csv
    ElectricVehiclePricing/Data/evcwidrs/input/SLP/Substations.csv
    ElectricVehiclePricing/Data/evcwidrs/input/SLP/Zones.csv
    
The software generates the following output files:

    ElectricVehiclePricing/Data/evcwidrs/generated/battSocVisual/<personID>/*.plt
    ElectricVehiclePricing/Data/evcwidrs/generated/electricStatVisual/*.plt
    
NOTE:   The software can generate a lot of output data. The size of the output is 
        highly related to the size of the input data. If you use our input data
        the size of the output will be approximately 100MB.
        
You can transform all the .plt files to .png files by using the following command the 
ElectricVehiclePricing directory. This can take a while.

    > python plot.py
    
    
    Starting the OSGi framework
====================================

Everything is ready to run. Run the following command in the ElectricVehiclePricing directory
to start the OSGi framework with the generated bundles:

    > python osgi.py linux
	
NOTE:   This can take several seconds, so don't panic if nothing happens within 10 seconds.
	
If everything went well, you should see something like:

    OSGi > 
	
You can check if everything is installed by the following command:

    OSGi > ss
	
If every bundle has a "ACTIVE" label, you can use the provided function.
	
You can start the provided function by the following command:

    OSGi > startEVC

To exit the OSGi framework, use the following command:

    OSGi > exit
	
NOTE:   If you exit the framework in a different way, the OSGi framework might
        keep running. You can try to reconnect to the running framework with the
        following command:
		
            OSGi > netcat -q 1 localhost 4446 
		
        If this command does not take you back, the framework was shut down correctly.
